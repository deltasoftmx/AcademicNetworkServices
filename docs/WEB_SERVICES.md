# Web services documentation

## Index
* [General information](#General-information)
  * [Response data structure](#Response-data-structure)
  * [Mandatory headers](#Mandatory-headers)
  * [Codes](#Codes)
    * [General codes](#General-codes)
    * [Fatal error codes](#Fatal-error-codes)
* [Social Network API](#Social-Network-API)
  * [Create student](#Create-student)
  * [Sign in](#Sign-in)
  * [Get user data](#Get-user-data)
  * [Search users](#Search-users)

## General information

### Response data structure

```json
{
  "code": 0,
  "data": { },
  "messages": [ ]
}
```

* `code`: The exit code of the process. Helpfully to see what exactly happened.
* `data`: The data requested, or the data returned when the execution was correct.
* `messages`: A message array to help the programmer to identify easier what happened with the process.

### Mandatory headers
* **Content-Type**: application/json
* **x-api-key**: [Hash provided by server maintainer]
* **Authorization**: [JWT generated by a call to the signin endpoint of Social Network API]

Authorization header is not always required but it is at most of endpoints. Where it is required will be
mentioned on headers section of the endpoint description. This header is used to authenticate the user
that requests an endpoint.

### Codes

Following codes are common in all endpoints of the **Social Network API** and the **Administration API**.

#### General codes

The kind of codes are negative numbers. They represents errors with the data provided by the client. They DO NOT
represent an invalid comvination of data, but a invalid data type, a missing argument, an unauthorized use of the API
or in a spetial case, an unknown error.

* 0: Success.
* -1: Params are not corrects.
* -2: User token expired.
* -3: User authentication (token) not valid.
* -4: Application not allowed to use the service.
* -5: An unknown error. Check log/crash_reports.log and API log files to see what happened.

#### Fatal error codes

These are server-side errors and must be addressed as soon as possible. If they happen, application keep
working but some important features are not going to work.

* 1000: RSA keys were not found when trying to sign o verify a token.
  * What to do: You need to put the RSA key pair in their right place. Read the [documentation of how to setup the environment](ENV_SETUP.md)
  and read the RSA certs section.

## Social Network API

### Create student

#### Description

Create a new student user in the system.

#### Endpoint
`/api/social-network/users/signup`

#### Headers

Not more than the mandatories.

#### Method

POST

#### Params

* `firstname`: string
* `lastname`: string
* `email`: string
* `passwd`: string
* `description`: string
* `user_type_id`: int
* `major_id`: int

#### Response data-structure

Void

#### Codes
* 1: Domain name not allowed.
* 2: Email already exists.
* 3: Username already exists.
* 4: User type doesn't exists.
* 5: Major doesn't exists.

### Sign in

#### Description

Generates a session token to be used by an user. This token must be sent in the `Authorization` header
of a request that calls to an endpoint that requires user authentication.

#### Endpoint
`/api/social-network/users/signin`

#### Headers

Not more than the mandatories.

#### Method

POST

#### Params

* `username`: string. It can be the username or email.
* `passwd`: string

#### Response data-structure

```json
{
  "session_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjp7ImlkIjoyMH0sImlhdCI6MTU5NTA1MzM5NSwiZXhwIjoxNTk1NjU4MTk1fQ.n39rxTNk6z64hIAh4BmJLucIjawBN0UGuU_IyVgCBa2vkzqsRhntU8YHQXMkmpZyzZTDWlowFSMfaNWOXthcK0O2U5gxKtXB-suRoEOijZu03c7B3BnIBZt4lid7KBhi3WME_JUJIV3xVQQiy-XIW0qMSsG3dJyHDB-jLAv1YL9vrGZdIobsAD0cipUyBrRfez4N824-EtlLjxyHHjsnmGeMMqhebIL3Lkgb-OaHDzqVgEcULRqqXozuGXHYw4a5Qs41eIF2q7zrq1DQueXGuNG-NKnB8gP8Hx_0Z_zT0syI6tfCyfFtF11-BAL7fEOOIBjsRW7grifqbZ3x8OXRiVdRewydvLHDqUqY5B4EdJEAK-q3WvxiolXZ-obYGY48enMuM4kLvrSL19Uu-NYbRk5Q3INoSecIsr2s_Kp2Ac8d-4gYjzCLyad8cmhXRZP8kzLVfdx6wpWvcG5vJB1YVa1rqms-ldsecZNhsTE5eqcv7TDxrSMJPR11RTqDx-DK"
}
```

#### Codes

No particular codes.

### Get user data

#### Description

Retrieve the user public information according of the user type. For example, if the user is a student
so within the data will be the major, or if the user is a teacher so within the data will be the email.

#### Endpoint

`/api/social-network/users/:username`

#### Headers

Not more than the mandatories.

#### Method

GET

#### Params

* `username`: string.

#### Response data-structure

```json
{
  "username": "jonhdoe",
  "firstname": "John",
  "lastname": "Doe",
  "description": "Hi I'm John Doe",
  "profile_img_src": "",
  "created_at": "2020-07-20T16:31:31.000Z",
  "user_type": "Estudiante",
  "major": "Data Engineering"
}
```

#### Codes
* 1: Username doesn't exists.

### Search users

#### Description

Performs a search of a certain relative kind of user, based on the user that ask for the search. It can retrieve 
all of users, followers or users followed by the requesting user that match with a search criteria. If the search 
field is empty, the records are not disciminated. Records are served into groups of a certain size called pages. 
You can select the group size and what group get in a call.

This endpoint also return how much records were found with the search criteria.

#### Endpoint

`/api/social-network/users/search`

#### Headers

* `Authorization`

#### Method

GET

#### Params

All of the following parameters are optional. It has default values.

* `user_relative_type`: string.

This parameter set what relative type of user to search for. It can be all kind of users (`all`), followers of the user
(`followers`) or the users that the user follow (`followed`). Default `all`.

* `offset`: int.

The size of the group of records to retrieve. Default `10`.

* `page`: int.

The number of the group to retrieve. Pages starts at `0`, what is also the defaul value.

* `search`: string.

The search critrea. Defaul is an empty string.

* `asc`: int.

If records are retrieved in ascending order. Default `1`. Use `0` for false.

#### Response data-structure

```json
{
  "users": [
    {
      "username": "person 4",
      "firstname": "person 4 firstname",
      "lastname": "person 4 lastname",
      "profile_img_src": ""
    },
    {
      "username": "person 3",
      "firstname": "person 3 firstname",
      "lastname": "person 3 lastname",
      "profile_img_src": ""
    }
  ],
  "total_records": 4
}
```

#### Codes

No particular codes.
